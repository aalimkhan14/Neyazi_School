<!DOCTYPE html>
<html lang="ps" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      .required-star {
        color: red;
        font-weight: bold;
        margin: 0 4px;
        user-select: none;
      }
      #rheader {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <div id="rparent">
      <form id="teacher_registration" class="rcover">
        <div id="rheader">ثبت مشخصات معلم</div>

        <div id="rcontent">
          <div id="one">
            <label for="name">
              <span>اسم: <span class="required-star">*</span></span>
              <input id="name" name="name" type="text" required />
            </label>

            <label for="lname">
              <span>تخلص:</span>
              <input id="lname" name="lname" type="text" />
            </label>

            <label for="fname">
              <span>ولد: <span class="required-star">*</span></span>
              <input id="fname" name="fname" type="text" required />
            </label>

            <label for="gfname">
              <span>ولدیت: <span class="required-star">*</span></span>
              <input id="gfname" name="gfname" type="text" required />
            </label>
          </div>

          <div id="two">
            <label for="birth">
              <span>تاریخ تولد: </span>
              <input
                id="birth"
                name="birth"
                type="text"
                readonly
              />
            </label>

            <label for="idcard">
              <span>نمبر تذکره: <span class="required-star">*</span></span>
              <input id="idcard" name="idcard" type="text" required />
            </label>

            <label for="phone">
              <span>شماره تماس: <span class="required-star">*</span></span>
              <input id="phone" name="phone" type="text" pattern="07\d{8}" maxlength="10" title="Must start with 07 and be 10 digits" required />
            </label>

            <label for="address">
              <span>آدرس: </span>
              <input id="address" name="address" type="text" />
            </label>
          </div>

          <div id="three">
            <label for="educatelevel">
              <span>درجه تحصیل: <span class="required-star">*</span></span>
              <select id="educatelevel" name="educatelevel" required>
                <option value="فارغ از مکتب">فارغ از مکتب</option>
                <option value="نیمه عالی">نیمه عالی</option>
                <option value="لیسانس">لیسانس</option>
                <option value="ماستر">ماستر</option>
                <option value="دکتر">دکتر</option>
              </select>
            </label>
            
            <label for="educateunit">
              <span>رشته تحصیلی:</span>
              <input id="educateunit" name="educateunit" type="text" />
            </label>

            <label for="graduatedate">
              <span> سال فراغت:</span>
              <input id="graduatedate" name="graduatedate" type="number" min="1370" max="1450" />
            </label>

            <label for="graduateplace">
              <span>محل فراغت:</span>
              <input id="graduateplace" name="graduateplace" type="text" />
            </label>
          </div>

          <div id="four">
            <label for="job">
              <span>وظیفه: <span class="required-star">*</span></span>
              <input id="job" name="job" type="text" required />
            </label>
            <label for="salary">
              <span>معاش: <span class="required-star">*</span></span>
              <input id="salary" name="salary" type="text" required />
            </label>
            <label for="formcode">
              <span>فورم کود: </span>
              <input id="formcode" name="formcode" type="text" />
            </label>
            <label for="agreement" class="file-input-label" style=" display: flex; align-items: center; justify-content: center; height: 48px; margin-top: 34px; cursor: pointer;">
              <span class="file-button" id="txt_attachment">اضافه نمودن اسناد قرار داد</span>
              <input type="file" id="agreement" name="agreement" accept=".pdf, image/*"  style="display: none"/>
            </label>
          </div>
          <div id="five">
              <label for="diplomaLetter" class="file-input-label" style=" display: flex; align-items: center; justify-content: center; height: 48px; margin-top: 34px; cursor: pointer;">
                <span class="file-button" id="txt_diploma">اضافه نمودن اسناد تحصیلی</span>
                <input type="file" id="diplomaLetter" name="diplomaLetter" accept=".pdf, image/*"  style="display: none"/>
              </label>
              <label for="idCardLetter" class="file-input-label" style=" display: flex; align-items: center; justify-content: center; height: 48px; margin-top: 34px; cursor: pointer;">
                <span class="file-button" id="txt_idcard">اضافه نمودن اسناد تذکره</span>
                <input type="file" id="idCardLetter" name="idCardLetter" accept=".pdf, image/*"  style="display: none"/>
              </label>
              <label for="">
                <input type="hidden">
              </label>
              <label for="">
                <input type="hidden">
              </label>
            </div>
          </div>

        <div id="rfooter">
          <input type="submit" id="save" value="ثبت کردن" />
          <input type="reset" id="exit" value="پاک کردن" />
        </div>
      </form>
    </div>
    <script src="./../../js/Date_Elemet.js"></script>
    <script>
      datePicker('#birth');
    </script>
   <script src="./../../js/Date_Elemet.js"></script>
<script>
  datePicker("#birth");
</script>

<script>
document.getElementById("teacher_registration").addEventListener("submit", async function (e) {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData();

  // append text fields
  formData.append("name", form.name.value.trim());
  formData.append("lname", form.lname.value.trim());
  formData.append("fname", form.fname.value.trim());
  formData.append("gfname", form.gfname.value.trim());
  formData.append("birth", form.birth.value);
  formData.append("idcard", form.idcard.value.trim());
  formData.append("phone", form.phone.value.trim());
  formData.append("address", form.address.value.trim());
  formData.append("educatelevel", form.educatelevel.value);
  formData.append("educateunit", form.educateunit.value.trim());
  formData.append("graduatedate", form.graduatedate.value);
  formData.append("graduateplace", form.graduateplace.value.trim());
  formData.append("job", form.job.value);
  formData.append("salary", form.salary.value.trim());
  formData.append("formcode", form.formcode.value.trim());

  // append file field (controller expects `agreementFile`)
  if (form.agreement.files.length > 0) {
    formData.append("agreementFile", form.agreement.files[0]);
  }
  if (form.diplomaLetter.files.length > 0) {
    formData.append("diplomaFile", form.diplomaLetter.files[0]);
  }
  if (form.idCardLetter.files.length > 0) {
    formData.append("idCardFile", form.idCardLetter.files[0]);
  }

  try {
    const response = await fetch("http://localhost:3000/teachers", {
      method: "POST",
      body: formData,
    });

    if (response.ok) {
      showModal({
        	title: "موفقیت",
        	message: "معلم موفقانه ثبت شد.",
        	icon: "success",
      });
      form.reset();
      document.getElementById("txt_attachment").innerText = "اضافه نمودن اسناد قرار داد";
    } else {
      const error = await response.json();
      alert("خطا در ثبت معلم: " + (error.message || ""));
      console.log(error);
    }
  } catch (error) {
    console.error("Error:", error);
    alert("خطا در اتصال به سرور");
  }
});


// ✅ To change attachment text after selecting the file
document.getElementById("agreement").addEventListener("change", function () {
  const label = document.getElementById("txt_attachment");
  if (this.files.length > 0) {
    label.innerText = "اسناد قرار داد اضافه شد";
  } else {
    label.innerText = "اضافه نمودن اسناد قرار داد";
  }
});
document.getElementById("diplomaLetter").addEventListener("change", function () {
  const label = document.getElementById("txt_diploma");
  if (this.files.length > 0) {
    label.innerText = "اسناد تحصیلی اضافه شد";
  } else {
    label.innerText = "اضافه نمودن اسناد تحصیلی";
  }
});
document.getElementById("idCardLetter").addEventListener("change", function () {
  const label = document.getElementById("txt_idcard");
  if (this.files.length > 0) {
    label.innerText = "اسناد تذکره اضافه شد";
  } else {
    label.innerText = "اضافه نمودن اسناد تذکره";
  }
});
</script>
